{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.symbol\");\n\nrequire(\"core-js/modules/es.symbol.description\");\n\nrequire(\"core-js/modules/es.symbol.iterator\");\n\nrequire(\"core-js/modules/es.array.filter\");\n\nrequire(\"core-js/modules/es.array.find\");\n\nrequire(\"core-js/modules/es.array.find-index\");\n\nrequire(\"core-js/modules/es.array.includes\");\n\nrequire(\"core-js/modules/es.array.iterator\");\n\nrequire(\"core-js/modules/es.array.map\");\n\nrequire(\"core-js/modules/es.array.sort\");\n\nrequire(\"core-js/modules/es.array.splice\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptor\");\n\nrequire(\"core-js/modules/es.object.get-prototype-of\");\n\nrequire(\"core-js/modules/es.object.keys\");\n\nrequire(\"core-js/modules/es.object.to-string\");\n\nrequire(\"core-js/modules/es.reflect.construct\");\n\nrequire(\"core-js/modules/es.reflect.get\");\n\nrequire(\"core-js/modules/es.string.includes\");\n\nrequire(\"core-js/modules/es.string.iterator\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator\");\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _WebformBuilder2 = _interopRequireDefault(require(\"./WebformBuilder\"));\n\nvar _Webform = _interopRequireDefault(require(\"./Webform\"));\n\nvar _builder = _interopRequireDefault(require(\"./utils/builder\"));\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nvar _utils = require(\"./utils/utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nvar WizardBuilder = /*#__PURE__*/function (_WebformBuilder) {\n  _inherits(WizardBuilder, _WebformBuilder);\n\n  var _super = _createSuper(WizardBuilder);\n\n  function WizardBuilder() {\n    var _this;\n\n    _classCallCheck(this, WizardBuilder);\n\n    var element, options;\n\n    if (arguments[0] instanceof HTMLElement || arguments[1]) {\n      element = arguments[0];\n      options = arguments[1];\n    } else {\n      options = arguments[0];\n    } // Reset skipInit in case PDFBuilder has set it.\n\n\n    options.skipInit = false;\n    options.display = 'wizard';\n    _this = _super.call(this, element, options);\n    _this._form = {\n      components: [_this.getPageConfig(1)]\n    };\n    _this.page = 0; // Need to create a component order for each group.\n\n    var _loop = function _loop(group) {\n      if (_this.groups[group] && _this.groups[group].components) {\n        _this.groups[group].componentOrder = Object.keys(_this.groups[group].components).map(function (key) {\n          return _this.groups[group].components[key];\n        }).filter(function (component) {\n          return component && !component.ignore;\n        }).sort(function (a, b) {\n          return a.weight - b.weight;\n        }).map(function (component) {\n          return component.key;\n        });\n      }\n    };\n\n    for (var group in _this.groups) {\n      _loop(group);\n    }\n\n    _this.options.hooks.attachPanel = function (element, component) {\n      if (component.refs.removeComponent) {\n        _this.addEventListener(component.refs.removeComponent, 'click', function () {\n          var pageIndex = _this.pages.findIndex(function (page) {\n            return page.key === component.key;\n          });\n\n          var componentIndex = _this._form.components.findIndex(function (comp) {\n            return comp.key === component.key;\n          });\n\n          if (pageIndex !== -1) {\n            _this.removePage(pageIndex, componentIndex);\n          }\n        });\n      }\n    };\n\n    var originalRenderComponentsHook = _this.options.hooks.renderComponents;\n\n    _this.options.hooks.renderComponents = function (html, _ref) {\n      var components = _ref.components,\n          self = _ref.self;\n\n      if (self.type === 'form' && !self.root) {\n        return html;\n      } else {\n        return originalRenderComponentsHook(html, {\n          components: components,\n          self: self\n        });\n      }\n    };\n\n    var originalAttachComponentsHook = _this.options.hooks.attachComponents;\n\n    _this.options.hooks.attachComponents = function (element, components, container, component) {\n      if (component.type === 'form' && !component.root) {\n        return element;\n      }\n\n      return originalAttachComponentsHook(element, components, container, component);\n    }; // Wizard pages don't replace themselves in the right array. Do that here.\n\n\n    _this.on('saveComponent', function (component, originalComponent) {\n      var webformComponents = _this.webform.components.map(function (_ref2) {\n        var component = _ref2.component;\n        return component;\n      });\n\n      if (_this._form.components.includes(originalComponent)) {\n        _this._form.components[_this._form.components.indexOf(originalComponent)] = component;\n\n        _this.rebuild();\n      } else if (webformComponents.includes(originalComponent)) {\n        _this._form.components.push(component);\n\n        _this.rebuild();\n      } else {\n        // Fallback to look for panel based on key.\n        var formComponentIndex = _this._form.components.findIndex(function (comp) {\n          return originalComponent.key === comp.key;\n        });\n\n        if (formComponentIndex !== -1) {\n          _this._form.components[formComponentIndex] = component;\n\n          _this.rebuild();\n        }\n      }\n    }, true);\n\n    return _this;\n  }\n\n  _createClass(WizardBuilder, [{\n    key: \"allowDrop\",\n    value: function allowDrop(element) {\n      return this.webform && this.webform.refs && this.webform.refs.webform === element ? false : true;\n    }\n  }, {\n    key: \"pages\",\n    get: function get() {\n      return _lodash.default.filter(this._form.components, {\n        type: 'panel'\n      });\n    }\n  }, {\n    key: \"currentPage\",\n    get: function get() {\n      var pages = this.pages;\n      return pages && pages.length >= this.page ? pages[this.page] : null;\n    }\n  }, {\n    key: \"form\",\n    get: function get() {\n      return this._form;\n    },\n    set: function set(value) {\n      this._form = value;\n\n      if (!this._form.components || !Array.isArray(this._form.components)) {\n        this._form.components = [];\n      }\n\n      if (this.pages.length === 0) {\n        var components = this._form.components.filter(function (component) {\n          return component.type !== 'button';\n        });\n\n        this._form.components = [this.getPageConfig(1, components)];\n      }\n\n      this.rebuild();\n    }\n  }, {\n    key: \"schema\",\n    get: function get() {\n      _lodash.default.assign(this.currentPage, this.webform._form.components[0]);\n\n      var webform = new _Webform.default(this.options);\n      webform.setForm(this._form, {\n        noEmit: true\n      });\n      return webform.schema;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return this.renderTemplate('builderWizard', {\n        sidebar: this.renderTemplate('builderSidebar', {\n          scrollEnabled: this.sideBarScroll,\n          groupOrder: this.groupOrder,\n          groupId: \"builder-sidebar-\".concat(this.id),\n          groups: this.groupOrder.map(function (groupKey) {\n            return _this2.renderTemplate('builderSidebarGroup', {\n              group: _this2.groups[groupKey],\n              groupKey: groupKey,\n              groupId: \"builder-sidebar-\".concat(_this2.id),\n              subgroups: _this2.groups[groupKey].subgroups.map(function (group) {\n                return _this2.renderTemplate('builderSidebarGroup', {\n                  group: group,\n                  groupKey: group.key,\n                  groupId: \"group-container-\".concat(groupKey),\n                  subgroups: []\n                });\n              })\n            });\n          })\n        }),\n        pages: this.pages,\n        form: this.webform.render()\n      });\n    }\n  }, {\n    key: \"attach\",\n    value: function attach(element) {\n      var _this3 = this;\n\n      this.loadRefs(element, {\n        addPage: 'multiple',\n        gotoPage: 'multiple'\n      });\n      this.refs.addPage.forEach(function (link) {\n        _this3.addEventListener(link, 'click', function (event) {\n          event.preventDefault();\n\n          _this3.addPage();\n        });\n      });\n      this.refs.gotoPage.forEach(function (link, index) {\n        _this3.addEventListener(link, 'click', function (event) {\n          event.preventDefault();\n\n          _this3.setPage(index);\n        });\n      });\n      return _get(_getPrototypeOf(WizardBuilder.prototype), \"attach\", this).call(this, element);\n    }\n  }, {\n    key: \"rebuild\",\n    value: function rebuild() {\n      var page = this.currentPage;\n      this.webform.setForm({\n        display: 'form',\n        type: 'form',\n        components: page ? [page] : []\n      }, {\n        keepAsReference: true\n      });\n      return this.redraw();\n    }\n  }, {\n    key: \"addPage\",\n    value: function addPage(page) {\n      var newPage = page && page.schema ? (0, _utils.fastCloneDeep)(page.schema) : this.getPageConfig(this.pages.length + 1);\n\n      _builder.default.uniquify(this._form.components, newPage);\n\n      this._form.components.push(newPage);\n\n      this.emitSaveComponentEvent(newPage, newPage, this._form, 'components', this._form.components.length - 1, true, newPage);\n      this.emit('change', this._form);\n      return this.rebuild();\n    }\n  }, {\n    key: \"removePage\",\n    value: function removePage(pageIndex, componentIndex) {\n      this._form.components.splice(componentIndex, 1);\n\n      this.emit('change', this._form);\n\n      if (pageIndex === this.pages.length) {\n        // If the last page is removed.\n        if (pageIndex === 0) {\n          this._form.components.push(this.getPageConfig(1));\n\n          return this.rebuild();\n        } else {\n          return this.setPage(pageIndex - 1);\n        }\n      } else {\n        return this.rebuild();\n      }\n    }\n  }, {\n    key: \"setPage\",\n    value: function setPage(index) {\n      if (index === this.page) {\n        return;\n      }\n\n      this.page = index;\n      return this.rebuild();\n    }\n  }, {\n    key: \"getPageConfig\",\n    value: function getPageConfig(index) {\n      var components = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n      return {\n        title: \"Page \".concat(index),\n        label: \"Page \".concat(index),\n        type: 'panel',\n        key: \"page\".concat(index),\n        components: components\n      };\n    }\n  }, {\n    key: \"pasteComponent\",\n    value: function pasteComponent(component) {\n      if (component instanceof WizardBuilder) {\n        return;\n      }\n\n      if (this._form.components.find(function (comp) {\n        return _lodash.default.isEqual(component.component, comp);\n      })) {\n        this.addPage(component);\n      } else {\n        return _get(_getPrototypeOf(WizardBuilder.prototype), \"pasteComponent\", this).call(this, component);\n      }\n    }\n  }]);\n\n  return WizardBuilder;\n}(_WebformBuilder2.default);\n\nexports.default = WizardBuilder;","map":null,"metadata":{},"sourceType":"script"}