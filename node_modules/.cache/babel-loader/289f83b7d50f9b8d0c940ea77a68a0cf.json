{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.auth = undefined;\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _slicedToArray = function () {\n  function sliceIterator(arr, i) {\n    var _arr = [];\n    var _n = true;\n    var _d = false;\n    var _e = undefined;\n\n    try {\n      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n        _arr.push(_s.value);\n\n        if (i && _arr.length === i) break;\n      }\n    } catch (err) {\n      _d = true;\n      _e = err;\n    } finally {\n      try {\n        if (!_n && _i[\"return\"]) _i[\"return\"]();\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n\n  return function (arr, i) {\n    if (Array.isArray(arr)) {\n      return arr;\n    } else if (Symbol.iterator in Object(arr)) {\n      return sliceIterator(arr, i);\n    } else {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n    }\n  };\n}();\n\nvar _constants = require('./constants');\n\nvar type = _interopRequireWildcard(_constants);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar initialState = {\n  init: false,\n  isActive: false,\n  user: null,\n  authenticated: false,\n  submissionAccess: {},\n  formAccess: {},\n  projectAccess: {},\n  roles: {},\n  is: {},\n  error: ''\n};\n\nfunction mapProjectRolesToUserRoles(projectRoles, userRoles) {\n  return Object.entries(projectRoles).reduce(function (result, _ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        name = _ref2[0],\n        role = _ref2[1];\n\n    return _extends({}, result, _defineProperty({}, name, userRoles.includes(role._id)));\n  }, {});\n}\n\nfunction getUserRoles(projectRoles) {\n  return Object.keys(projectRoles).reduce(function (result, name) {\n    return _extends({}, result, _defineProperty({}, name, name === 'anonymous'));\n  }, {});\n}\n\nvar auth = exports.auth = function auth(config) {\n  return function () {\n    var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n    var action = arguments[1];\n\n    switch (action.type) {\n      case type.USER_REQUEST:\n        return _extends({}, state, {\n          init: true,\n          submissionAccess: false,\n          isActive: true\n        });\n\n      case type.USER_REQUEST_SUCCESS:\n        return _extends({}, state, {\n          isActive: false,\n          user: action.user,\n          authenticated: true,\n          is: mapProjectRolesToUserRoles(state.roles, action.user.roles),\n          error: ''\n        });\n\n      case type.USER_REQUEST_FAILURE:\n        return _extends({}, state, {\n          isActive: false,\n          is: getUserRoles(state.roles),\n          error: action.error\n        });\n\n      case type.USER_LOGOUT:\n        return _extends({}, state, {\n          user: null,\n          isActive: false,\n          authenticated: false,\n          is: getUserRoles(state.roles),\n          error: ''\n        });\n\n      case type.USER_SUBMISSION_ACCESS:\n        return _extends({}, state, {\n          submissionAccess: action.submissionAccess\n        });\n\n      case type.USER_FORM_ACCESS:\n        return _extends({}, state, {\n          formAccess: action.formAccess\n        });\n\n      case type.USER_PROJECT_ACCESS:\n        return _extends({}, state, {\n          projectAccess: action.projectAccess\n        });\n\n      case type.USER_ROLES:\n        return _extends({}, state, {\n          roles: action.roles\n        });\n\n      default:\n        return state;\n    }\n  };\n};","map":null,"metadata":{},"sourceType":"script"}