{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.symbol\");\n\nrequire(\"core-js/modules/es.symbol.description\");\n\nrequire(\"core-js/modules/es.symbol.iterator\");\n\nrequire(\"core-js/modules/es.array.concat\");\n\nrequire(\"core-js/modules/es.array.from\");\n\nrequire(\"core-js/modules/es.array.includes\");\n\nrequire(\"core-js/modules/es.array.iterator\");\n\nrequire(\"core-js/modules/es.array.map\");\n\nrequire(\"core-js/modules/es.array.slice\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptor\");\n\nrequire(\"core-js/modules/es.object.get-prototype-of\");\n\nrequire(\"core-js/modules/es.object.to-string\");\n\nrequire(\"core-js/modules/es.reflect.construct\");\n\nrequire(\"core-js/modules/es.reflect.get\");\n\nrequire(\"core-js/modules/es.regexp.exec\");\n\nrequire(\"core-js/modules/es.string.includes\");\n\nrequire(\"core-js/modules/es.string.iterator\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator\");\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _Formio = require(\"./Formio\");\n\nvar _WebformBuilder2 = _interopRequireDefault(require(\"./WebformBuilder\"));\n\nvar _utils = require(\"./utils/utils\");\n\nvar _formUtils = require(\"./utils/formUtils\");\n\nvar _builder = _interopRequireDefault(require(\"./utils/builder\"));\n\nvar _PDF = _interopRequireDefault(require(\"./PDF\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nvar PDFBuilder = /*#__PURE__*/function (_WebformBuilder) {\n  _inherits(PDFBuilder, _WebformBuilder);\n\n  var _super = _createSuper(PDFBuilder);\n\n  function PDFBuilder() {\n    var _this;\n\n    _classCallCheck(this, PDFBuilder);\n\n    var element, options;\n\n    if (arguments[0] instanceof HTMLElement || arguments[1]) {\n      element = arguments[0];\n      options = arguments[1];\n    } else {\n      options = arguments[0];\n    } // Force superclass to skip the automatic init; we'll trigger it manually\n\n\n    options.skipInit = true;\n    options.display = 'pdf';\n\n    if (element) {\n      _this = _super.call(this, element, options);\n    } else {\n      _this = _super.call(this, options);\n    }\n\n    _this.dragDropEnabled = false;\n    return _possibleConstructorReturn(_this);\n  }\n\n  _createClass(PDFBuilder, [{\n    key: \"defaultGroups\",\n    get: function get() {\n      return {\n        pdf: {\n          title: 'PDF Fields',\n          weight: 0,\n          default: true,\n          components: {\n            textfield: true,\n            number: true,\n            password: true,\n            email: true,\n            phoneNumber: true,\n            currency: true,\n            checkbox: true,\n            signature: true,\n            select: true,\n            textarea: true,\n            datetime: true,\n            file: true,\n            htmlelement: true,\n            signrequestsignature: true\n          }\n        },\n        basic: false,\n        advanced: false,\n        layout: false,\n        data: false,\n        premium: false,\n        resource: false\n      };\n    }\n  }, {\n    key: \"hasPDF\",\n    get: function get() {\n      return _lodash.default.has(this.webform.form, 'settings.pdf');\n    }\n  }, {\n    key: \"projectUrl\",\n    get: function get() {\n      return this.options.projectUrl || _Formio.GlobalFormio.getProjectUrl();\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      this.options.attachMode = 'builder';\n      this.webform = this.webform || this.createForm(this.options);\n      this.webform.init();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var result = this.renderTemplate('pdfBuilder', {\n        sidebar: this.renderTemplate('builderSidebar', {\n          scrollEnabled: this.sideBarScroll,\n          groupOrder: this.groupOrder,\n          groupId: \"builder-sidebar-\".concat(this.id),\n          groups: this.groupOrder.map(function (groupKey) {\n            return _this2.renderTemplate('builderSidebarGroup', {\n              group: _this2.groups[groupKey],\n              groupKey: groupKey,\n              groupId: \"builder-sidebar-\".concat(_this2.id),\n              subgroups: _this2.groups[groupKey].subgroups.map(function (group) {\n                return _this2.renderTemplate('builderSidebarGroup', {\n                  group: group,\n                  groupKey: group.key,\n                  groupId: \"group-container-\".concat(groupKey),\n                  subgroups: []\n                });\n              })\n            });\n          })\n        }),\n        form: this.hasPDF ? this.webform.render() : this.renderTemplate('pdfBuilderUpload', {})\n      });\n      return result;\n    }\n  }, {\n    key: \"attach\",\n    value: function attach(element) {\n      var _this3 = this; // PDF Upload\n\n\n      if (!this.hasPDF) {\n        this.loadRefs(element, {\n          'fileDrop': 'single',\n          'fileBrowse': 'single',\n          'hiddenFileInputElement': 'single',\n          'uploadError': 'single',\n          'uploadProgress': 'single',\n          'uploadProgressWrapper': 'single',\n          'dragDropText': 'single'\n        });\n        this.addEventListener(this.refs['pdf-upload-button'], 'click', function (event) {\n          event.preventDefault();\n        }); // Init the upload error.\n\n        if (!this.projectUrl) {\n          this.setUploadError('Form options.projectUrl not set. Please set the \"projectUrl\" property of the options for this form or use Formio.setProjectUrl(). This setting is necessary to upload a pdf background.');\n        } else {\n          this.setUploadError();\n        }\n\n        if (this.refs.fileDrop) {\n          var _element = this;\n\n          this.addEventListener(this.refs.fileDrop, 'dragover', function (event) {\n            this.className = 'fileSelector fileDragOver';\n            event.preventDefault();\n          });\n          this.addEventListener(this.refs.fileDrop, 'dragleave', function (event) {\n            this.className = 'fileSelector';\n            event.preventDefault();\n          });\n          this.addEventListener(this.refs.fileDrop, 'drop', function (event) {\n            this.className = 'fileSelector';\n            event.preventDefault();\n\n            _element.upload(event.dataTransfer.files[0]);\n\n            return false;\n          });\n        }\n\n        if (this.refs.fileBrowse && this.refs.hiddenFileInputElement) {\n          this.addEventListener(this.refs.fileBrowse, 'click', function (event) {\n            event.preventDefault(); // There is no direct way to trigger a file dialog. To work around this, create an input of type file and trigger\n            // a click event on it.\n\n            if (typeof _this3.refs.hiddenFileInputElement.trigger === 'function') {\n              _this3.refs.hiddenFileInputElement.trigger('click');\n            } else {\n              _this3.refs.hiddenFileInputElement.click();\n            }\n          });\n          this.addEventListener(this.refs.hiddenFileInputElement, 'change', function () {\n            if (!_this3.refs.hiddenFileInputElement.value) {\n              return;\n            }\n\n            _this3.upload(_this3.refs.hiddenFileInputElement.files[0]);\n\n            _this3.refs.hiddenFileInputElement.value = '';\n          });\n        }\n\n        return _nativePromiseOnly.default.resolve();\n      } // Normal PDF Builder\n\n\n      return _get(_getPrototypeOf(PDFBuilder.prototype), \"attach\", this).call(this, element).then(function () {\n        _this3.loadRefs(_this3.element, {\n          iframeDropzone: 'single',\n          'sidebar-container': 'multiple',\n          'sidebar': 'single'\n        });\n\n        _this3.afterAttach();\n\n        return _this3.element;\n      });\n    }\n  }, {\n    key: \"afterAttach\",\n    value: function afterAttach() {\n      var _this4 = this;\n\n      this.on('saveComponent', function (component) {\n        _this4.webform.postMessage({\n          name: 'updateElement',\n          data: component\n        });\n      });\n      this.on('removeComponent', function (component) {\n        _this4.webform.postMessage({\n          name: 'removeElement',\n          data: component\n        });\n      });\n      this.initIframeEvents();\n      this.updateDropzoneDimensions();\n      var sidebar = this.refs.sidebar;\n\n      if (sidebar) {\n        this.addClass(sidebar, 'disabled');\n        this.webform.on('iframe-ready', function () {\n          _this4.pdfLoaded = true;\n\n          _this4.updateDragAndDrop();\n\n          _this4.removeClass(sidebar, 'disabled');\n        }, true);\n      }\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      var _this5 = this;\n\n      return _get(_getPrototypeOf(PDFBuilder.prototype), \"redraw\", this).call(this).then(function () {\n        return _this5.webform.redraw();\n      });\n    }\n  }, {\n    key: \"upload\",\n    value: function upload(file) {\n      var _this6 = this;\n\n      var formio = new _Formio.GlobalFormio(this.projectUrl);\n\n      if (this.refs.dragDropText) {\n        this.refs.dragDropText.style.display = 'none';\n      }\n\n      if (this.refs.uploadProgressWrapper) {\n        this.refs.uploadProgressWrapper.style.display = 'inherit';\n      }\n\n      formio.uploadFile('url', file, file, '', function (event) {\n        if (_this6.refs.uploadProgress) {\n          var progress = Math.floor(event.loaded / event.total * 100);\n          _this6.refs.uploadProgress.style.width = \"\".concat(progress, \"%\");\n\n          if (progress > 98) {\n            _this6.refs.uploadProgress.innerHTML = _this6.t('Converting PDF. Please wait.');\n          } else {\n            _this6.refs.uploadProgress.innerHTML = \"\".concat(_this6.t('Uploading'), \" \").concat(progress, \"%\");\n          }\n        }\n      }, \"\".concat(this.projectUrl, \"/upload\"), {}, 'file').then(function (result) {\n        _lodash.default.set(_this6.webform.form, 'settings.pdf', {\n          id: result.data.file,\n          src: \"\".concat(result.data.filesServer).concat(result.data.path)\n        });\n\n        if (_this6.refs.dragDropText) {\n          _this6.refs.dragDropText.style.display = 'inherit';\n        }\n\n        if (_this6.refs.uploadProgressWrapper) {\n          _this6.refs.uploadProgressWrapper.style.display = 'none';\n        }\n\n        _this6.emit('pdfUploaded', result.data);\n\n        _this6.redraw();\n      }).catch(function (err) {\n        return _this6.setUploadError(err);\n      });\n    }\n  }, {\n    key: \"setUploadError\",\n    value: function setUploadError(message) {\n      if (!this.refs.uploadError) {\n        return;\n      }\n\n      this.refs.uploadError.style.display = message ? '' : 'none';\n      this.refs.uploadError.innerHTML = message;\n    }\n  }, {\n    key: \"createForm\",\n    value: function createForm(options) {\n      var _this7 = this; // Instantiate the webform from the PDF class instead of Webform\n\n\n      options.skipInit = false;\n      options.hideLoader = true;\n      this.webform = new _PDF.default(this.element, options);\n      this.webform.on('attach', function () {\n        // If the dropzone exists but has been removed in a PDF rebuild, reinstate it\n        if (_this7.refs.iframeDropzone && !_toConsumableArray(_this7.refs.form.children).includes(_this7.refs.iframeDropzone)) {\n          _this7.prependTo(_this7.refs.iframeDropzone, _this7.refs.form);\n        }\n      });\n      return this.webform;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy(deleteFromGlobal) {\n      _get(_getPrototypeOf(PDFBuilder.prototype), \"destroy\", this).call(this, deleteFromGlobal);\n\n      this.webform.destroy(deleteFromGlobal);\n    } // d8b 8888888888                                                                              888\n    // Y8P 888                                                                                     888\n    //     888                                                                                     888\n    // 888 8888888 888d888 8888b.  88888b.d88b.   .d88b.        .d88b.  888  888  .d88b.  88888b.  888888 .d8888b\n    // 888 888     888P\"      \"88b 888 \"888 \"88b d8P  Y8b      d8P  Y8b 888  888 d8P  Y8b 888 \"88b 888    88K\n    // 888 888     888    .d888888 888  888  888 88888888      88888888 Y88  88P 88888888 888  888 888    \"Y8888b.\n    // 888 888     888    888  888 888  888  888 Y8b.          Y8b.      Y8bd8P  Y8b.     888  888 Y88b.       X88\n    // 888 888     888    \"Y888888 888  888  888  \"Y8888        \"Y8888    Y88P    \"Y8888  888  888  \"Y888  88888P'\n\n  }, {\n    key: \"getParentContainer\",\n    value: function getParentContainer(component) {\n      var container = [];\n      var originalComponent = null;\n      (0, _formUtils.eachComponent)(this.webform._form.components, function (comp, path, components) {\n        if (comp.id === component.component.id) {\n          container = components;\n          originalComponent = comp;\n          return true;\n        }\n      }, true);\n      return {\n        formioComponent: component.parent,\n        formioContainer: container,\n        originalComponent: originalComponent\n      };\n    }\n  }, {\n    key: \"initIframeEvents\",\n    value: function initIframeEvents() {\n      var _this8 = this;\n\n      this.webform.off('iframe-elementUpdate');\n      this.webform.off('iframe-componentUpdate');\n      this.webform.off('iframe-componentClick');\n      this.webform.on('iframe-elementUpdate', function (schema) {\n        var component = _this8.webform.getComponentById(schema.id);\n\n        if (component && component.component) {\n          var isNew = true;\n          component.component.overlay = {\n            page: schema.page,\n            left: schema.left,\n            top: schema.top,\n            height: schema.height,\n            width: schema.width\n          };\n\n          if (!_this8.options.noNewEdit && !component.component.noNewEdit) {\n            _this8.editComponent(component.component, _this8.getParentContainer(component), isNew);\n          }\n\n          _this8.emit('updateComponent', component.component);\n        }\n\n        return component;\n      });\n      this.webform.on('iframe-componentUpdate', function (schema) {\n        var component = _this8.webform.getComponentById(schema.id);\n\n        if (component && component.component) {\n          component.component.overlay = {\n            page: schema.overlay.page,\n            left: schema.overlay.left,\n            top: schema.overlay.top,\n            height: schema.overlay.height,\n            width: schema.overlay.width\n          };\n\n          _this8.emit('updateComponent', component.component);\n\n          _this8.emit('change', _this8.form);\n        }\n\n        return component;\n      });\n      this.webform.on('iframe-componentClick', function (schema) {\n        var component = _this8.webform.getComponentById(schema.id);\n\n        if (component) {\n          _this8.editComponent(component.component, _this8.getParentContainer(component));\n        }\n      }, true);\n    } // 8888888b.                                                                   888                   d8b\n    // 888  \"Y88b                                                                  888                   Y8P\n    // 888    888                                                                  888\n    // 888    888 888d888 .d88b.  88888b. 88888888  .d88b.  88888b.   .d88b.       888  .d88b.   .d88b.  888  .d8888b\n    // 888    888 888P\"  d88\"\"88b 888 \"88b   d88P  d88\"\"88b 888 \"88b d8P  Y8b      888 d88\"\"88b d88P\"88b 888 d88P\"\n    // 888    888 888    888  888 888  888  d88P   888  888 888  888 88888888      888 888  888 888  888 888 888\n    // 888  .d88P 888    Y88..88P 888 d88P d88P    Y88..88P 888  888 Y8b.          888 Y88..88P Y88b 888 888 Y88b.\n    // 8888888P\"  888     \"Y88P\"  88888P\" 88888888  \"Y88P\"  888  888  \"Y8888       888  \"Y88P\"   \"Y88888 888  \"Y8888P\n    //                            888                                                                888\n    //                            888                                                           Y8b d88P\n    //                            888                                                            \"Y88P\"\n\n  }, {\n    key: \"initDropzoneEvents\",\n    value: function initDropzoneEvents() {\n      if (!this.refs.iframeDropzone) {\n        return;\n      } // This is required per HTML spec in order for the drop event to fire\n\n\n      this.removeEventListener(this.refs.iframeDropzone, 'dragover');\n      this.removeEventListener(this.refs.iframeDropzone, 'drop');\n      this.addEventListener(this.refs.iframeDropzone, 'dragover', function (e) {\n        e.preventDefault();\n        return false;\n      });\n      this.addEventListener(this.refs.iframeDropzone, 'drop', this.onDropzoneDrop.bind(this));\n    }\n  }, {\n    key: \"updateDragAndDrop\",\n    value: function updateDragAndDrop() {\n      if (!this.pdfLoaded) {\n        return;\n      }\n\n      this.initDropzoneEvents();\n      this.prepSidebarComponentsForDrag();\n    }\n  }, {\n    key: \"prepSidebarComponentsForDrag\",\n    value: function prepSidebarComponentsForDrag() {\n      var _this9 = this;\n\n      if (!this.refs['sidebar-container']) {\n        return;\n      }\n\n      this.refs['sidebar-container'].forEach(function (container) {\n        _toConsumableArray(container.children).forEach(function (el) {\n          el.draggable = true;\n          el.setAttribute('draggable', true);\n\n          _this9.removeEventListener(el, 'dragstart');\n\n          _this9.removeEventListener(el, 'dragend');\n\n          _this9.addEventListener(el, 'dragstart', _this9.onDragStart.bind(_this9), true);\n\n          _this9.addEventListener(el, 'dragend', _this9.onDragEnd.bind(_this9), true);\n\n          _this9.addEventListener(el, 'drag', function (e) {\n            e.target.style.cursor = 'none';\n          });\n        });\n      });\n    }\n  }, {\n    key: \"updateDropzoneDimensions\",\n    value: function updateDropzoneDimensions() {\n      if (!this.refs.iframeDropzone) {\n        return;\n      }\n\n      var iframeRect = (0, _utils.getElementRect)(this.webform.refs.iframeContainer);\n      this.refs.iframeDropzone.style.height = iframeRect && iframeRect.height ? \"\".concat(iframeRect.height, \"px\") : '1000px';\n      this.refs.iframeDropzone.style.width = iframeRect && iframeRect.width ? \"\".concat(iframeRect.width, \"px\") : '100%';\n    }\n  }, {\n    key: \"onDragStart\",\n    value: function onDragStart(e) {\n      // Taking the current offset of a dragged item relative to the cursor\n      var _e$offsetX = e.offsetX,\n          offsetX = _e$offsetX === void 0 ? 0 : _e$offsetX,\n          _e$offsetY = e.offsetY,\n          offsetY = _e$offsetY === void 0 ? 0 : _e$offsetY;\n      this.itemOffsetX = offsetX;\n      this.itemOffsetY = offsetY;\n      e.dataTransfer.setData('text', '');\n      this.updateDropzoneDimensions();\n      this.addClass(this.refs.iframeDropzone, 'enabled');\n    }\n  }, {\n    key: \"onDropzoneDrop\",\n    value: function onDropzoneDrop(e) {\n      this.dropEvent = e;\n      e.preventDefault();\n      return false;\n    }\n  }, {\n    key: \"onDragEnd\",\n    value: function onDragEnd(e) {\n      // IMPORTANT - must retrieve offsets BEFORE disabling the dropzone - offsets will\n      // reflect absolute positioning if accessed after the target element is hidden\n      var layerX = this.dropEvent ? this.dropEvent.layerX : null;\n      var layerY = this.dropEvent ? this.dropEvent.layerY : null;\n      var WIDTH = 100;\n      var HEIGHT = 20; // Always disable the dropzone on drag end\n\n      this.removeClass(this.refs.iframeDropzone, 'enabled'); // If there hasn't been a drop event on the dropzone, we're done\n\n      if (!this.dropEvent) {\n        return;\n      }\n\n      var element = e.target;\n      var type = element.getAttribute('data-type');\n      var key = element.getAttribute('data-key');\n      var group = element.getAttribute('data-group');\n      var schema = (0, _utils.fastCloneDeep)(this.schemas[type]);\n\n      if (key && group) {\n        var info = this.getComponentInfo(key, group);\n\n        _lodash.default.merge(schema, info);\n      } // Set a unique key for this component.\n\n\n      _builder.default.uniquify([this.webform._form], schema);\n\n      this.webform._form.components.push(schema);\n\n      schema.overlay = {\n        top: layerY - this.itemOffsetY + HEIGHT,\n        left: layerX - this.itemOffsetX,\n        width: WIDTH,\n        height: HEIGHT\n      };\n      this.webform.addComponent(schema, {}, null, true);\n      this.webform.postMessage({\n        name: 'addElement',\n        data: schema\n      });\n      this.emit('addComponent', schema, this.webform, schema.key, this.webform.component.components.length, !this.options.noNewEdit && !schema.noNewEdit); // Delete the stored drop event now that it's been handled\n\n      this.dropEvent = null;\n      e.target.style.cursor = 'default';\n    }\n  }, {\n    key: \"highlightInvalidComponents\",\n    value: function highlightInvalidComponents() {\n      var _this10 = this;\n\n      var repeatablePaths = this.findRepeatablePaths(); // update elements which path was duplicated if any pathes have been changed\n\n      if (!_lodash.default.isEqual(this.repeatablePaths, repeatablePaths)) {\n        (0, _formUtils.eachComponent)(this.webform.getComponents(), function (comp, path) {\n          if (_this10.repeatablePaths.includes(path)) {\n            _this10.webform.postMessage({\n              name: 'updateElement',\n              data: comp.component\n            });\n          }\n        });\n        this.repeatablePaths = repeatablePaths;\n      }\n\n      if (!repeatablePaths.length) {\n        return;\n      }\n\n      (0, _formUtils.eachComponent)(this.webform.getComponents(), function (comp, path) {\n        if (_this10.repeatablePaths.includes(path)) {\n          _this10.webform.postMessage({\n            name: 'showBuilderErrors',\n            data: {\n              compId: comp.component.id,\n              errorMessage: \"API Key is not unique: \".concat(comp.key)\n            }\n          });\n        }\n      });\n    }\n  }]);\n\n  return PDFBuilder;\n}(_WebformBuilder2.default);\n\nexports.default = PDFBuilder;","map":null,"metadata":{},"sourceType":"script"}