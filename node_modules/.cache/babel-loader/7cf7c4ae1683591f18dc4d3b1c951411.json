{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _immutabilityHelper = _interopRequireDefault(require(\"immutability-helper\"));\n\nvar _store = _interopRequireDefault(require(\"./stores/store\"));\n\nvar _formElementsEdit = _interopRequireDefault(require(\"./form-elements-edit\"));\n\nvar _sortableFormElements = _interopRequireDefault(require(\"./sortable-form-elements\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _createSuper(Derived) {\n  return function () {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (_isNativeReflectConstruct()) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar PlaceHolder = _sortableFormElements[\"default\"].PlaceHolder;\n\nvar Preview = /*#__PURE__*/function (_React$Component) {\n  _inherits(Preview, _React$Component);\n\n  var _super = _createSuper(Preview);\n\n  function Preview(props) {\n    var _this;\n\n    _classCallCheck(this, Preview);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"editModeOff\", function (e) {\n      if (_this.editForm.current && !_this.editForm.current.contains(e.target)) {\n        _this.manualEditModeOff();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"manualEditModeOff\", function () {\n      var editElement = _this.props.editElement;\n\n      if (editElement && editElement.dirty) {\n        editElement.dirty = false;\n\n        _this.updateElement(editElement);\n      }\n\n      _this.props.manualEditModeOff();\n    });\n\n    var onLoad = props.onLoad,\n        onPost = props.onPost;\n\n    _store[\"default\"].setExternalHandler(onLoad, onPost);\n\n    _this.editForm = _react[\"default\"].createRef();\n    _this.state = {\n      data: [],\n      answer_data: {}\n    };\n    _this.seq = 0;\n\n    var onUpdate = _this._onChange.bind(_assertThisInitialized(_this));\n\n    _store[\"default\"].subscribe(function (state) {\n      return onUpdate(state.data);\n    });\n\n    _this.moveCard = _this.moveCard.bind(_assertThisInitialized(_this));\n    _this.insertCard = _this.insertCard.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(Preview, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (this.props.data !== nextProps.data) {\n        _store[\"default\"].dispatch('updateOrder', nextProps.data);\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this$props = this.props,\n          data = _this$props.data,\n          url = _this$props.url,\n          saveUrl = _this$props.saveUrl;\n\n      _store[\"default\"].dispatch('load', {\n        loadUrl: url,\n        saveUrl: saveUrl,\n        data: data || []\n      });\n\n      document.addEventListener('mousedown', this.editModeOff);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.removeEventListener('mousedown', this.editModeOff);\n    }\n  }, {\n    key: \"_setValue\",\n    value: function _setValue(text) {\n      return text.replace(/[^A-Z0-9]+/ig, '_').toLowerCase();\n    }\n  }, {\n    key: \"updateElement\",\n    value: function updateElement(element) {\n      var data = this.state.data;\n      var found = false;\n\n      for (var i = 0, len = data.length; i < len; i++) {\n        if (element.id === data[i].id) {\n          data[i] = element;\n          found = true;\n          break;\n        }\n      }\n\n      if (found) {\n        this.seq = this.seq > 100000 ? 0 : this.seq + 1;\n\n        _store[\"default\"].dispatch('updateOrder', data);\n      }\n    }\n  }, {\n    key: \"_onChange\",\n    value: function _onChange(data) {\n      var _this2 = this;\n\n      var answer_data = {};\n      data.forEach(function (item) {\n        if (item && item.readOnly && _this2.props.variables[item.variableKey]) {\n          answer_data[item.field_name] = _this2.props.variables[item.variableKey];\n        }\n      });\n      this.setState({\n        data: data,\n        answer_data: answer_data\n      });\n    }\n  }, {\n    key: \"_onDestroy\",\n    value: function _onDestroy(item) {\n      _store[\"default\"].dispatch('delete', item);\n    }\n  }, {\n    key: \"insertCard\",\n    value: function insertCard(item, hoverIndex) {\n      var data = this.state.data;\n      data.splice(hoverIndex, 0, item);\n      this.saveData(item, hoverIndex, hoverIndex);\n    }\n  }, {\n    key: \"moveCard\",\n    value: function moveCard(dragIndex, hoverIndex) {\n      var data = this.state.data;\n      var dragCard = data[dragIndex];\n      this.saveData(dragCard, dragIndex, hoverIndex);\n    } // eslint-disable-next-line no-unused-vars\n\n  }, {\n    key: \"cardPlaceHolder\",\n    value: function cardPlaceHolder(dragIndex, hoverIndex) {// Dummy\n    }\n  }, {\n    key: \"saveData\",\n    value: function saveData(dragCard, dragIndex, hoverIndex) {\n      var newData = (0, _immutabilityHelper[\"default\"])(this.state, {\n        data: {\n          $splice: [[dragIndex, 1], [hoverIndex, 0, dragCard]]\n        }\n      });\n      this.setState(newData);\n\n      _store[\"default\"].dispatch('updateOrder', newData.data);\n    }\n  }, {\n    key: \"getElement\",\n    value: function getElement(item, index) {\n      var SortableFormElement = _sortableFormElements[\"default\"][item.element];\n      return /*#__PURE__*/_react[\"default\"].createElement(SortableFormElement, {\n        id: item.id,\n        seq: this.seq,\n        index: index,\n        moveCard: this.moveCard,\n        insertCard: this.insertCard,\n        mutable: false,\n        parent: this.props.parent,\n        editModeOn: this.props.editModeOn,\n        isDraggable: true,\n        key: item.id,\n        sortData: item.id,\n        data: item,\n        _onDestroy: this._onDestroy\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var classes = this.props.className;\n\n      if (this.props.editMode) {\n        classes += ' is-editing';\n      }\n\n      var data = this.state.data.filter(function (x) {\n        return !!x;\n      });\n      var items = data.map(function (item, index) {\n        return _this3.getElement(item, index);\n      });\n      return /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n        className: classes\n      }, /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n        className: \"edit-form\",\n        ref: this.editForm\n      }, this.props.editElement !== null && /*#__PURE__*/_react[\"default\"].createElement(_formElementsEdit[\"default\"], {\n        showCorrectColumn: this.props.showCorrectColumn,\n        files: this.props.files,\n        manualEditModeOff: this.manualEditModeOff,\n        preview: this,\n        element: this.props.editElement,\n        updateElement: this.updateElement\n      })), /*#__PURE__*/_react[\"default\"].createElement(\"div\", {\n        className: \"Sortable\"\n      }, items), /*#__PURE__*/_react[\"default\"].createElement(PlaceHolder, {\n        id: \"form-place-holder\",\n        show: items.length === 0,\n        index: items.length,\n        moveCard: this.cardPlaceHolder,\n        insertCard: this.insertCard\n      }));\n    }\n  }]);\n\n  return Preview;\n}(_react[\"default\"].Component);\n\nexports[\"default\"] = Preview;\nPreview.defaultProps = {\n  showCorrectColumn: false,\n  files: [],\n  editMode: false,\n  editElement: null,\n  className: 'react-form-builder-preview float-left'\n};","map":null,"metadata":{},"sourceType":"script"}