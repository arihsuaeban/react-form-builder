{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.concat\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _xhr = require(\"./xhr\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nvar googledrive = function googledrive(formio) {\n  return {\n    uploadFile: function uploadFile(file, fileName, dir, progressCallback, url, options, fileKey, groupPermissions, groupId, abortCallback) {\n      return new _nativePromiseOnly.default(function (resolve, reject) {\n        // Send the file with data.\n        var xhr = new XMLHttpRequest();\n\n        if (typeof progressCallback === 'function') {\n          xhr.upload.onprogress = progressCallback;\n        }\n\n        if (typeof abortCallback === 'function') {\n          abortCallback(function () {\n            return xhr.abort();\n          });\n        }\n\n        var fd = new FormData();\n        fd.append('name', fileName);\n        fd.append('dir', dir);\n        fd.append('file', file); // Fire on network error.\n\n        xhr.onerror = function (err) {\n          err.networkError = true;\n          reject(err);\n        };\n\n        xhr.onload = function () {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            var response = JSON.parse(xhr.response);\n            response.storage = 'googledrive';\n            response.size = file.size;\n            response.type = file.type;\n            response.groupId = groupId;\n            response.groupPermissions = groupPermissions;\n            resolve(response);\n          } else {\n            reject(xhr.response || 'Unable to upload file');\n          }\n        };\n\n        xhr.onabort = reject;\n        xhr.open('POST', \"\".concat(formio.formUrl, \"/storage/gdrive\"));\n        (0, _xhr.setXhrHeaders)(formio, xhr);\n        var token = formio.getToken();\n\n        if (token) {\n          xhr.setRequestHeader('x-jwt-token', token);\n        }\n\n        xhr.send(fd);\n      });\n    },\n    downloadFile: function downloadFile(file) {\n      var token = formio.getToken();\n      file.url = \"\".concat(formio.formUrl, \"/storage/gdrive?fileId=\").concat(file.id, \"&fileName=\").concat(file.originalName).concat(token ? \"&x-jwt-token=\".concat(token) : '');\n      return _nativePromiseOnly.default.resolve(file);\n    }\n  };\n};\n\ngoogledrive.title = 'Google Drive';\nvar _default = googledrive;\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script"}